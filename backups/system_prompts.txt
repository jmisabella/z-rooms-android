We did it… we updated my existing z rooms app to add our planned new functionality. The z rooms app has 35 available looping audio files for sleeping, guided meditation, chilling out, and waking up. Its audio files are of 4 styles: white noise, dark ambient, bright ambient, and classical compositions. People set a duration (or infinite) of the listening session and when it’s completed the audio either fades to zero or fades into a different audio file for waking up.



Well the new feature we’ve added is pretty significant. We’ve added text to speech functionality. Now users can optionally toggle on a random guided meditation that accompanies the existing app functionality, playing the guided meditation narration voice over the ambient audio. There are 10 prewritten guided meditations. The voice is intentionally a bit artificial sounding, like Stephen Hawking doing guided meditation over different ambient sounds. We are intentionally using the built in voice provided by Apple so users don’t need to mess with downloading any of the more modern realistic voice packages which are large in size. The app is 100% offline, free, ad free, subscription free, and about 110MB in size. The artificial sounding voice style actually really works well for this app’s audio (think that Pink Floyd song with Stephen Hawking from The Division Bell) and was a happy accident.



But there’s more!! Users can also write their OWN custom meditations and save up to 10 custom meditations. We even have it so users can set pause breaks between words: (2s) or (1.5m) for example. If user deletes all of their custom medi ations, the default custom meditation comes back so they can have a nice example one with pauses that they can start with, and they can duplicate meditaions to make it easy on them.



There’s an Android version of this same app. We have not implemented the new guided meditation feature on the android side. To complicate things a bit: the iOS app is already published at version 1.9 while the Android app is as of yet unpublished… it’s currently submitted for deployment approval in play  store connect and Google is currently reviewing it and we expect them to approve it for our initial version 1.0 deployment this week.



Preparation 



I need you to help me implement this same new feature on the Android side which is in Kotlin. I will share with you the Swift files from the iOS side for reference if that helps (I think it would, for functionality reference so we don’t recreate too many wheels unnecessarily). 



I will now summarize the changes we made on the iOS side. We need to now make these same changes/improvements to the Android app's side, in Kotlin. A copy of the iOS files are available in the iOS_file_copies folder (inside zz-time subdirectory) that we can use as a reference point. I propose that we try to tackle just a single piece of functionality at a time, so we can test each piece before moving onto the next, in the steps ordered below. Also, notice that we are referencing the Android project from inside VSCode, and we do have the Kotlin extension installed, yet I've never actually built or developed Kotlin in VSCode. I propose that you make the changes here, and I would test them by installing to my device from the separate Android studio app. One thing I'm a bit unsure of is whether we will break anything by building the Kotlin code directly her in VSCode to simplify our development process.  

1). The expanding view used to fade to darkness in 3 minutes. We changed it to be 10 minutes.

2). There are 3 buttons at the bottom of expanding view in the order of sun, moon, and clock. We reordered these to be sun, clock, moon.

3). We implemented a text to speech component. We added functionality so it can read f text files and speak them. We configured the voice to be a specific range and slowness and volume level. We added functionality so that when reading text it knows to pause for specific regex patterns such as (3s) for 3 seconds and (1.5m) for 1.5 minutes. We also added special functionality to pause intentionally at end of each sentence or line in the specific use case that a user didn’t add and pause breaks (3s) at all in the meditation text, so there would be at least pauses at end of each line as a fail safe to prevent users who don’t understand the (2s) special syntax for pausing can still write nice sounding meditations by just using new lines for brief pauses (like a poem).

4). We added a Meditations folder with some built in meditation text files. In it, we added a default_custom_meditation.txt, preset_meditation1.txt, preset_meditation2.txt, and preset_meditation3.txt.

5). We repurposed the moon button on expanding view to no longer do the darkness thing but instead to randomly play one of the meditations from the Meditations folder whose file name has the “preset_” prefix. The meditation plays over top of the selected ambient audio file. We also changed this button’s icon from a moon to a leaf. As the button now toggles on and off a random preset meditation, the leaf turns green when toggled on.

6). We repurposed the sun button in expanding view to no longer do the brightness thing but instead to open a list of the user’s custom meditations. User can store your to 10 custom meditation files here. Users can save their own custom meditations and these custom meditations persisted between app sessions (in memory). By default there is one editable default meditation (uses value of the default_custom_meditation.txt). Whenever user deletes all of their custom meditations, this default one comes back. Users can create new custom meditations as well as edit, duplicate, and delete their existing ones. Users can also play any of their custom meditations from this list, which takes them back to expanding view playing the selected custom meditations (with leaf button toggled on to show it’s enabled). We changed the icon of this repurposed button from the sub to a quotes icon.

7). We added a new 2nd slider just underneath the duration slider at top of expanding view screen. This new slider controls the ambient audio. By default it is all the way to the right (full ambient audio). User can slide it left to turn the ambient audio down. Like the duration slider, this ambient balance slider shows a label only when it’s actively being adjusted. This label shows ambient percentage to user. The labels in the sliders don’t show when they are not actively being adjusted, keeping the design nice and minimal.
